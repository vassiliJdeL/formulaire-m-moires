<!DOCTYPE html>
<html>
<head>
  <title>Soumettre un mémoire</title>
  <script>
    UPLOADCARE_PUBLIC_KEY = "21d7228fa1f01ac80183";
    UPLOADCARE_LOCALE = "fr";
    UPLOADCARE_TABS = "file url";
    UPLOADCARE_STORE = "auto";
  </script>
  <script src="https://ucarecdn.com/libs/widget/3.x/uploadcare.full.min.js"></script>
</head>
<body>
  <h1>Soumettre un mémoire .docx</h1>
  <form id="upload-form">
    <label>Nom :</label><br />
    <input type="text" name="nom" required /><br /><br />

    <label>Prénom :</label><br />
    <input type="text" name="prenom" required /><br /><br />

    <label>Titre du mémoire :</label><br />
    <input type="text" name="titre" required /><br /><br />

    <label>Email :</label><br />
    <input type="email" name="email" required /><br /><br />

    <label>Langue :</label><br />
    <select name="langue">
      <option value="fr">Français</option>
      <option value="en">English</option>
    </select><br /><br />

    <input type="checkbox" name="rgpd" required />
    <label>J'accepte le traitement de mes données pour l’évaluation automatisée</label><br /><br />

    <label>Fichier mémoire (.docx uniquement) :</label><br />
    <input type="hidden" role="uploadcare-uploader" name="fichier" data-clearable="true" /><br /><br />

    <button type="submit">Envoyer</button>
  </form>

  <script>
    document.getElementById("upload-form").addEventListener("submit", function (e) {
      e.preventDefault();

      const form = e.target;
      const fileUUID = form.fichier.value;

      if (!fileUUID) {
        alert("Veuillez téléverser un fichier .docx.");
        return;
      }

      // Utilisation de fileInfo pour obtenir l’URL complète
      uploadcare.fileFrom("uploaded", fileUUID).then(file => file.done(info => {
        const url = info.cdnUrl;

        const payload = {
          nom: form.nom.value,
          prenom: form.prenom.value,
          titre: form.titre.value,
          email: form.email.value,
          langue: form.langue.value,
          rgpd: form.rgpd.checked,
          url: url
        };

        console.log("Payload prêt à envoyer :", payload);
        alert("Formulaire prêt. Données à envoyer au scénario Make.");
        
        // Ici, tu peux envoyer le payload avec fetch/post si besoin
      }));
    });
  </script>
</body>
</html>
