<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Bienvenue dans l'espace évaluation du mémoire / Welcome to the thesis assessment area</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial,sans-serif;line-height:1.45;margin:0;background:#fafafa;color:#222}
    .wrap{max-width:760px;margin:40px auto;padding:0 16px}
    h1{font-size:1.6rem;margin:0 0 8px}
    .muted{color:#666;margin:0 0 24px}
    label{font-weight:600}
    input[type="text"],input[type="email"],select{width:100%;max-width:520px;padding:10px 12px;margin-top:6px;margin-bottom:18px;border:1px solid #ccc;border-radius:8px;background:#fff}
    .hint{font-size:.92rem;color:#555;margin:-10px 0 18px}
    .consigne{font-size:.95rem;background:#fff3cd;border:1px solid #ffe08a;color:#6b5300;padding:10px 12px;border-radius:8px;display:inline-block;margin:6px 0 18px}
    button{background:#111;color:#fff;border:0;border-radius:10px;padding:12px 18px;font-weight:700;cursor:pointer}
    button:disabled{opacity:.6;cursor:not-allowed}
    .ok{display:none;margin-top:24px;background:#e8f5e9;border:1px solid #a5d6a7;color:#1b5e20;padding:16px;border-radius:10px}
    .rgpd{margin:14px 0}
    .rgpd p{margin:8px 0}
    .small{font-size:.92rem;color:#555}
  </style>

  <!-- Uploadcare widget -->
  <script>
    window.UPLOADCARE_PUBLIC_KEY = "21d7228fa1f01ac80183";
  </script>
  <script src="https://ucarecdn.com/libs/widget/3.x/uploadcare.full.min.js" defer></script>
</head>
<body>
  <div class="wrap">
    <h1>Soumission de mémoire / Thesis submission</h1>
    <p class="muted">Merci de compléter soigneusement tous les champs ci-dessous.</p>

    <!-- Formulaire -->
    <form id="memoire-form" action="https://vassili-jdel.app.n8n.cloud/webhook-test/auto-eval-memoire" method="post" novalidate>
      <label for="prenom">Prénom / First name *</label>
      <input type="text" id="prenom" name="prenom" required />

      <label for="nom">Nom / Last name *</label>
      <input type="text" id="nom" name="nom" required />

      <label for="email">Email *</label>
      <input type="email" id="email" name="email" required />

      <label for="titre">Titre du mémoire / Thesis title *</label>
      <input type="text" id="titre" name="titre" required />

      <label for="langue">Langue / Language *</label>
      <select id="langue" name="langue" required>
        <option value="">—</option>
        <option value="français">Français / French</option>
        <option value="anglais">Anglais / English</option>
      </select>

      <label for="file">Fichier .docx / .docx file *</label>
      <input
        type="hidden"
        role="uploadcare-uploader"
        name="file"
        data-public-key="21d7228fa1f01ac80183"
        data-multiple="false"
        data-clearable
        data-file-types="docx"
        data-input-accept=".docx"
      />
      <div class="consigne">30 000 mots maximum – 30,000 words maximum</div>

      <div class="rgpd">
        <label>
          <input type="checkbox" id="rgpd" name="rgpd" required />
          <span><strong>RGPD / GDPR consent *</strong></span>
        </label>
        <p class="small">
          <strong>FR :</strong> Les données collectées via ce formulaire sont utilisées pour l’évaluation du mémoire de fin d’études.
          Le fichier téléversé n’est pas stocké. Il est supprimé automatiquement à la fin de l’évaluation. Vous pouvez exercer vos droits
          d'accès, de rectification, de suppression, en nous contactant à
          <a href="mailto:vassili.joannides.de.lautour@gmail.com">vassili.joannides.de.lautour@gmail.com</a>.
          Ce formulaire est conforme au RGPD car il recueille votre consentement explicite via la case à cocher ci-contre.
        </p>
        <p class="small">
          <strong>EN (UK):</strong> The data collected through this form is used solely to assess your master’s thesis.
          The uploaded file is not stored and is automatically deleted at the end of the evaluation. You can exercise your rights of access,
          rectification and erasure by contacting
          <a href="mailto:vassili.joannides.de.lautour@gmail.com">vassili.joannides.de.lautour@gmail.com</a>.
          This form complies with the UK GDPR as it collects your explicit consent via the checkbox.
        </p>
      </div>

      <input type="hidden" name="token" value="2_TOUGH_eval_5_on" />
      <input type="hidden" name="url" value="" />
      <input type="hidden" name="fileUrl" value="" />
      <input type="hidden" name="filename" value="" />

      <button type="submit" id="submitBtn">Soumettre / Submit</button>
    </form>

    <div id="confirmation" class="ok">
      <h2>✅ Envoi confirmé</h2>
      <p>Nous traitons ton évaluation. Tu la recevras par email dans les prochaines minutes.</p>
      <p><em>We are processing your assessment. You’ll receive it by email shortly.</em></p>
    </div>
  </div>

  <script>
    window.addEventListener('DOMContentLoaded', function () {
      const form = document.getElementById('memoire-form');
      const submitBtn = document.getElementById('submitBtn');
      const widget = uploadcare.Widget('[role=uploadcare-uploader]');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        if (!form.checkValidity()) { form.reportValidity(); return; }

        const fileValue = widget.value();
        if (!fileValue) { alert("Merci d’ajouter un fichier .docx avant d’envoyer."); return; }

        submitBtn.disabled = true;

        try {
          const info = await fileValue.promise(); // { cdnUrl, name, ... }
          if (!info || !info.cdnUrl) { alert("Erreur Uploadcare : URL du fichier introuvable."); submitBtn.disabled = false; return; }

          const fd = new FormData(form);
          fd.set('url', info.cdnUrl);
          fd.set('fileUrl', info.cdnUrl);
          fd.set('filename', info.name || 'memoire.docx');
          fd.delete('file');

          const resp = await fetch(form.action, { method: 'POST', body: fd });

          if (resp.ok) {
            form.style.display = 'none';
            document.getElementById('confirmation').style.display = 'block';
          } else {
            const t = await resp.text().catch(() => "");
            alert("Erreur lors de la soumission. Détail: " + (t || resp.status));
            submitBtn.disabled = false;
          }
        } catch (err) {
          console.error(err);
          alert("Erreur réseau / upload. Réessaie.");
          submitBtn.disabled = false;
        }
      });
    });
  </script>
</body>
</html>
